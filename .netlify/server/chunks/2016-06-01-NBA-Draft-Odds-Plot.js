import "clsx";
import { h as html } from "./html.js";
const metadata = {
  "title": "NBA Draft Odds Plot",
  "description": "Reproduce an NBA draft odds stacked bar plot",
  "tags": ["R", "ggplot2", "data", "dataviz", "NBA"],
  "date": "2016-06-01",
  "featured": false,
  "categories": "posts",
  "img": "/img/draft_odds.png"
};
const { title, description, tags, date, featured, categories, img } = metadata;
function _016_06_01_NBA_Draft_Odds_Plot_md($$payload) {
  $$payload.out += `<p><strong>Original Source</strong></p> <p>I was scrolling twitter and noticed this tweet from David Sparks - Director of Basketball Analytics for the Boston Celtics:</p> <blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">With thanks to <a href="https://twitter.com/hadleywickham">@hadleywickham</a>, <a href="https://twitter.com/hrbrmstr">@hrbrmstr</a>, and <a href="https://twitter.com/ColorBrewer">@ColorBrewer</a>. <a href="https://twitter.com/hashtag/rstats?src=hash">#rstats</a> <a href="https://t.co/hjX39Xhi4P">https://t.co/hjX39Xhi4P</a> <a href="https://t.co/XD27alzwNI">https://t.co/XD27alzwNI</a>— David Sparks (@dsparks) <a href="https://twitter.com/dsparks/status/723497233988096004">April 22, 2016</a></p></blockquote> <p>With his obligatory shoutouts to Hadley Wickham and BoB Rudis, I felt compelled to reproduce the plot in RStudio and get some ggplot2 code out there open-sourcing his work.</p> <p><strong>Package Dependencies and Data</strong></p> <p>The data was generated using simulations of the NBA Draft lottery, which resulted in some peculiar distributions compared to the <a href="https://en.wikipedia.org/wiki/2016_NBA_draft" rel="nofollow">raw lottery odds</a>. I fudged some of the data based on how it looked in the plot - not much I can do about that since there wasn’t anything programmatically to work from there! <code>¯\\_(ツ)_/¯</code></p> <pre class="language-r">${html(`<code class="language-r"><span class="token comment">#devtools::install_github("hadley/ggplot2")</span>
<span class="token comment">#devtools::install_github("hadley/tidyr")</span>
library<span class="token punctuation">(</span>ggplot2<span class="token punctuation">)</span>
library<span class="token punctuation">(</span>tidyr<span class="token punctuation">)</span>
library<span class="token punctuation">(</span>RCurl<span class="token punctuation">)</span>
library<span class="token punctuation">(</span>RColorBrewer<span class="token punctuation">)</span>
dataurl <span class="token operator">&lt;-</span> <span class="token string">'https://gist.githubusercontent.com/mikeleeco/268429d0b4019ec30c4e547c16d7f766/raw/afa955af265d14a2f72780e4e0b87ffe469c0109/odds.csv'</span>
data <span class="token operator">&lt;-</span> getURL<span class="token punctuation">(</span>dataurl<span class="token punctuation">)</span>
odds <span class="token operator">&lt;-</span> read.csv<span class="token punctuation">(</span>textConnection<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></code>`)}</pre> <p><strong>Data Cleanup</strong></p> <p>The tidyr package allows us to reshape our data between long and wide formats, RColorBrewer helps generate a fluid color pallete for our plot, and RCurl assists in sourcing the data from <a href="https://gist.github.com/mikeleeco/268429d0b4019ec30c4e547c16d7f766#file-odds-csv" rel="nofollow">my gist</a>.</p> <pre class="language-r">${html(`<code class="language-r">odds <span class="token operator">&lt;-</span> gather<span class="token punctuation">(</span>odds<span class="token punctuation">,</span> X<span class="token punctuation">)</span>
odds<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> substring<span class="token punctuation">(</span>odds<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>odds<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"Team"</span><span class="token punctuation">,</span><span class="token string">"Pick"</span><span class="token punctuation">,</span><span class="token string">"Probability"</span><span class="token punctuation">)</span>
odds<span class="token operator">$</span>Pick <span class="token operator">&lt;-</span> as.numeric<span class="token punctuation">(</span>odds<span class="token operator">$</span>Pick<span class="token punctuation">)</span>
odds<span class="token operator">$</span>Team <span class="token operator">&lt;-</span> as.character<span class="token punctuation">(</span>odds<span class="token operator">$</span>Team<span class="token punctuation">)</span>
odds<span class="token operator">$</span>Team <span class="token operator">&lt;-</span> factor<span class="token punctuation">(</span>odds<span class="token operator">$</span>Team<span class="token punctuation">,</span> levels <span class="token operator">=</span> odds<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
odds<span class="token operator">$</span>Team <span class="token operator">&lt;-</span> factor<span class="token punctuation">(</span>odds<span class="token operator">$</span>Team<span class="token punctuation">,</span> levels<span class="token operator">=</span>rev<span class="token punctuation">(</span>levels<span class="token punctuation">(</span>odds<span class="token operator">$</span>Team<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
odds<span class="token operator">$</span>Pick <span class="token operator">&lt;-</span> factor<span class="token punctuation">(</span>odds<span class="token operator">$</span>Pick<span class="token punctuation">,</span> levels <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span>
getPalette <span class="token operator">&lt;-</span> colorRampPalette<span class="token punctuation">(</span>brewer.pal<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">"Spectral"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span>
odds<span class="token operator">$</span>Probability <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>odds<span class="token operator">$</span>Probability<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>odds<span class="token operator">$</span>Probability<span class="token punctuation">)</span></code>`)}</pre> <p>The <code>colorRampPallete</code> and <code>brewer.pal</code> functions expands the “Spectral” color pallete from 11 to 14 colors, and we’ve organized our Team y-axis to be leveled in order of likelihood of winning the top pick - without factoring in the projections that were used in the @celtics figure.</p> <p><strong>The Custom Plot Theme</strong></p> <p>Now that we’ve prepared our data, we can get to customizing the plot!</p> <pre class="language-r">${html(`<code class="language-r">g <span class="token operator">&lt;-</span> ggplot<span class="token punctuation">(</span>odds<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>Team<span class="token punctuation">)</span><span class="token punctuation">)</span>
g <span class="token operator">&lt;-</span> g <span class="token operator">+</span> geom_bar<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>x <span class="token operator">=</span> Team<span class="token punctuation">,</span> y <span class="token operator">=</span> Probability<span class="token punctuation">,</span> fill <span class="token operator">=</span> Pick<span class="token punctuation">)</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span>stat<span class="token operator">=</span><span class="token string">"identity"</span><span class="token punctuation">)</span>
g <span class="token operator">&lt;-</span> g <span class="token operator">+</span> scale_y_continuous<span class="token punctuation">(</span>breaks <span class="token operator">=</span> seq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> by <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">"Probability"</span><span class="token punctuation">,</span> labels<span class="token operator">=</span>scales<span class="token operator">::</span>percent<span class="token punctuation">)</span> <span class="token operator">+</span>
    labs<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token keyword">NULL</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token keyword">NULL</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">"2016 NBA Draft Lottery Probabilities"</span><span class="token punctuation">,</span>
         subtitle <span class="token operator">=</span> <span class="token string">"After tiebreakers and trades. Trades with protections are indicated by a black border, and the receiving team is named. Based on 100,000 simulations"</span><span class="token punctuation">,</span>
         caption<span class="token operator">=</span><span class="token string">"Reproduced by: @mikeleeco                  Original: @dsparks                  Source: http://www.nba.com/celtics/news/sidebar/2016-draft-lottery-qa"</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    coord_flip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    scale_fill_manual<span class="token punctuation">(</span>values <span class="token operator">=</span> getPalette<span class="token punctuation">)</span></code>`)}</pre> <p>The development version of <a href="https://github.com/hadley/ggplot2" rel="nofollow">ggplot2 on github</a> features numerous additions including ecpanded arguments for <code>labs</code> such as subtitles and captions. Check out <code>?ggplot2::labs</code> or <a href="https://rud.is/b/2016/03/16/supreme-annotations/" rel="nofollow">Bob Rudis’ post</a> on his contribution to ggplot2.</p> <pre class="language-r">${html(`<code class="language-r">g <span class="token operator">&lt;-</span> g  <span class="token operator">+</span> theme<span class="token punctuation">(</span>
  axis.text.x <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span>margin<span class="token operator">=</span>margin<span class="token punctuation">(</span>b<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>color <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  axis.title.x <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  plot.subtitle <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  plot.caption <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span>margin <span class="token operator">=</span> margin<span class="token punctuation">(</span>t<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>face <span class="token operator">=</span> <span class="token string">"italic"</span><span class="token punctuation">,</span> hjust <span class="token operator">=</span> <span class="token number">.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  axis.text.y <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span>margin <span class="token operator">=</span> margin<span class="token punctuation">(</span>r<span class="token operator">=</span><span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span>colour <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  axis.ticks.y<span class="token operator">=</span>element_blank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  axis.ticks.x<span class="token operator">=</span>element_blank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  plot.title <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>margin <span class="token operator">=</span> margin<span class="token punctuation">(</span>b<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  panel.border<span class="token operator">=</span>element_blank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  panel.grid.major.x<span class="token operator">=</span>element_line<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">"#2b2b2b"</span><span class="token punctuation">,</span> linetype<span class="token operator">=</span><span class="token string">"dotted"</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  panel.grid.major.y<span class="token operator">=</span>element_blank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  legend.text <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  legend.title <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  legend.key <span class="token operator">=</span> element_rect<span class="token punctuation">(</span>fill<span class="token operator">=</span><span class="token string">"#DCDCDC"</span><span class="token punctuation">,</span>colour <span class="token operator">=</span> <span class="token string">"#DCDCDC"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  legend.background <span class="token operator">=</span> element_rect<span class="token punctuation">(</span>fill<span class="token operator">=</span><span class="token string">"#DCDCDC"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  panel.background <span class="token operator">=</span> element_rect<span class="token punctuation">(</span>fill<span class="token operator">=</span><span class="token string">"#DCDCDC"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  plot.background <span class="token operator">=</span> element_rect<span class="token punctuation">(</span>fill<span class="token operator">=</span><span class="token string">"#DCDCDC"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code>`)}</pre> <p>As seen in the theme here, the developtmental version of ggplot2 also features elements to customize the new caption and subtitle arguments. Things are looking pretty sharp!</p> <p><strong>Annotations - Call for Help!</strong></p> <p>The lottery data has been transformed into a customized plot; the only missing pieces are the transparent rectangular grobs indicating picks with trade implications. I tried a few different methods to programmatically assign labels over the rows in our dataset, none of which gave the desired final output. Instead I used brute force to place transparent rectangles and texts over the appropriate data blocks:</p> <pre class="language-r">${html(`<code class="language-r">g <span class="token operator">&lt;-</span> g <span class="token operator">+</span> annotate<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">13.45</span><span class="token operator">+</span><span class="token number">12.55</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">.6</span><span class="token punctuation">,</span> alpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"to PHI"</span><span class="token punctuation">,</span> size<span class="token operator">=</span> rel<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            annotate<span class="token punctuation">(</span><span class="token string">"rect"</span><span class="token punctuation">,</span> xmin <span class="token operator">=</span> <span class="token number">12.55</span><span class="token punctuation">,</span> xmax <span class="token operator">=</span> <span class="token number">13.45</span><span class="token punctuation">,</span> ymin <span class="token operator">=</span> <span class="token number">.555</span><span class="token punctuation">,</span> ymax <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> alpha <span class="token operator">=</span> <span class="token number">.3</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            annotate<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2.45</span><span class="token operator">+</span><span class="token number">1.55</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">.1</span><span class="token punctuation">,</span> alpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"to PHX"</span><span class="token punctuation">,</span> size<span class="token operator">=</span> rel<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            annotate<span class="token punctuation">(</span><span class="token string">"rect"</span><span class="token punctuation">,</span> xmin <span class="token operator">=</span> <span class="token number">1.55</span><span class="token punctuation">,</span> xmax <span class="token operator">=</span> <span class="token number">2.45</span><span class="token punctuation">,</span> ymin <span class="token operator">=</span> <span class="token number">.021</span><span class="token punctuation">,</span> ymax <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> alpha <span class="token operator">=</span> <span class="token number">.3</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            annotate<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">7.45</span><span class="token operator">+</span><span class="token number">6.55</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">.95</span><span class="token punctuation">,</span> alpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"to CHI >"</span><span class="token punctuation">,</span> size<span class="token operator">=</span> rel<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            annotate<span class="token punctuation">(</span><span class="token string">"rect"</span><span class="token punctuation">,</span> xmin <span class="token operator">=</span> <span class="token number">6.55</span><span class="token punctuation">,</span> xmax <span class="token operator">=</span> <span class="token number">7.45</span><span class="token punctuation">,</span> ymin <span class="token operator">=</span> <span class="token number">.999</span><span class="token punctuation">,</span> ymax <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> alpha <span class="token operator">=</span> <span class="token number">.3</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span></code>`)}</pre> <p>There has to be a more efficient method to do this! If you know of a better way please <a href="http://www.twitter.com/mikeleeco" rel="nofollow">contact me on twitter</a> or create a <a href="https://github.com/mikeleeco/mikeleeco.github.com/blob/master/_source/2016-06-01-NBA-Draft-Odds-Plot.Rmd" rel="nofollow">pull request on this post</a>.</p> <p><strong>Final product:</strong></p> <div class="row"><img src="/img/draft_odds.png" alt="draft_odds" class="img-responsive center-block"/></div>`;
}
export {
  _016_06_01_NBA_Draft_Odds_Plot_md as default,
  metadata
};
