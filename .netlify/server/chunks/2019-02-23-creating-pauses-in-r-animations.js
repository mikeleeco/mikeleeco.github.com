import "clsx";
import { h as html } from "./html.js";
const metadata = {
  "title": "R Animation Tip: Creating Pauses",
  "author": "",
  "date": "2019-02-23",
  "categories": "posts",
  "tags": ["dataviz", "ggplot2", "animation", "R"],
  "featured": true,
  "description": "Improve your R animations by implementing pause frames for emphasis",
  "img": "/img/tx_Housing.png"
};
const {
  title,
  author,
  date,
  categories,
  tags,
  featured,
  description,
  img
} = metadata;
function _019_02_23_creating_pauses_in_r_animations_md($$payload) {
  $$payload.out += `<h2>Mastering Animation in R</h2> <p>Over the last couple years I’ve developed a multitude of animations
using R. During this process I’ve learned quite a bit about R graphics,
gpplot2, and useful techniques in animation. In fact I presented on
methods for animation in R at satRdays DC - <a href="http://bit.ly/animateDC" rel="nofollow">slides available
here</a></p> <hr/> <iframe src="https://www.youtube.com/embed/glbFxRbqGWk" title="Youtube video: Mastering Animation in R" frameborder="0" allowfullscreen class="video"></iframe> <hr/> <p>One simple technique to improving animations is the addition of pauses.
Pauses are an effective method of capturing the viewer’s attention and
driving home the main message of an animation. Pausing at the end of an
animation (before it loops) offers the viewer the full scope of the
visualization, and pauses during the animation can be used to emphasize
key data points.</p> <p><strong>Let’s walk through creating a pause in R.</strong></p> <h2>Creating Pauses in R - Libraries and Data Reshaping</h2> <p>We’ll use the <code>txhousing</code> data set in the <code>ggplot2</code> package to
demonstrate - this data set contains information regarding the housing
market in Texas provided by the <a href="http://recenter.tamu.edu/" rel="nofollow">TAMU real estate
center</a>. The animation will plot the median
sale price of two cities - Abilene and Amarillo - from 2000 to 2015.</p> <p>In my satuRdays DC presentation I covered the steps taken to develop an
R animation:</p> <ol><li><p>Interpolate your data</p></li> <li><p>Structure your data to create frames that move across the dimension
of interest</p></li> <li><p>Determine plot aspects that require consistency across the animation
(annotations, scales, legends, etc)</p></li> <li><p>Append and export the frames</p></li></ol> <p>The variable <code>year</code> contains the unique data values across our animation</p> <ul><li><code>split</code> will generate a list of data frames we can apply
interpolations to using the <code>tweenr</code> package.</li></ul> <details open><summary>R Libraries and Data Reshaping</summary> <pre class="language-r">${html(`<code class="language-r">    library<span class="token punctuation">(</span>ggplot2<span class="token punctuation">)</span>
    library<span class="token punctuation">(</span>scales<span class="token punctuation">)</span>
    library<span class="token punctuation">(</span>extrafont<span class="token punctuation">)</span>
    library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span>
    library<span class="token punctuation">(</span>tweenr<span class="token punctuation">)</span>
    library<span class="token punctuation">(</span>lubridate<span class="token punctuation">)</span>
    library<span class="token punctuation">(</span>animation<span class="token punctuation">)</span>
    library<span class="token punctuation">(</span>RColorBrewer<span class="token punctuation">)</span>
    library<span class="token punctuation">(</span>grid<span class="token punctuation">)</span>
    loadfonts<span class="token punctuation">(</span><span class="token punctuation">)</span>


    <span class="token comment"># create data frame from txhousing data included in ggplot2 package</span>
    txHousingData <span class="token operator">&lt;-</span> txhousing <span class="token percent-operator operator">%>%</span> filter<span class="token punctuation">(</span>city <span class="token percent-operator operator">%in%</span> unique<span class="token punctuation">(</span>txhousing<span class="token operator">$</span>city<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> month<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
    txHousingData <span class="token operator">&lt;-</span> txHousingData<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    txHousingData<span class="token operator">$</span>city <span class="token operator">&lt;-</span> factor<span class="token punctuation">(</span>txHousingData<span class="token operator">$</span>city<span class="token punctuation">,</span> levels <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Abilene"</span><span class="token punctuation">,</span><span class="token string">"Amarillo"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> labels <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Abilene"</span><span class="token punctuation">,</span><span class="token string">"Amarillo"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># determine the unique data values that tweenr will iterate over (in this case year)</span>
    txList <span class="token operator">&lt;-</span> split<span class="token punctuation">(</span>txHousingData<span class="token punctuation">,</span>txHousingData<span class="token operator">$</span>year<span class="token punctuation">)</span>

    <span class="token comment"># Apply tweenr to interpolate frames between data points</span>
    txTweenedData <span class="token operator">&lt;-</span> tween_states<span class="token punctuation">(</span>txList<span class="token punctuation">,</span> tweenlength<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> statelength<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> ease<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">,</span>nframes<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span></code>`)}</pre></details> <p>Since our data is arranged by year by default, it’s already structured
in a fashion that moves across our dimension of interest (change over
time) - so we’ve already completed the first two animation steps. Now
that we’ve got our interpolated data frame <code>txTweenedData</code> we can focus
on the plot aesthetics.</p> <h2>Plot Aesthetics</h2> <details open><summary>ggplot2 Theme and Color Palette</summary> <pre class="language-r">${html(`<code class="language-r">    <span class="token comment"># plot aesthetics</span>
    theme_white <span class="token operator">&lt;-</span> theme<span class="token punctuation">(</span>text <span class="token operator">=</span> element_text<span class="token punctuation">(</span>family<span class="token operator">=</span><span class="token string">"Open Sans"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         panel.grid.major.y<span class="token operator">=</span>element_blank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         panel.grid.major.x<span class="token operator">=</span>element_blank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         panel.grid.minor.x<span class="token operator">=</span>element_blank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         panel.grid.minor.y<span class="token operator">=</span>element_blank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         axis.title.x<span class="token operator">=</span>element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> margin <span class="token operator">=</span> margin<span class="token punctuation">(</span>t<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         axis.title.y<span class="token operator">=</span>element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> margin <span class="token operator">=</span> margin<span class="token punctuation">(</span>t<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         axis.text.x<span class="token operator">=</span>element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         axis.text.y<span class="token operator">=</span>element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         axis.ticks <span class="token operator">=</span> element_blank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         plot.title<span class="token operator">=</span>element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">,</span>family <span class="token operator">=</span> <span class="token string">"Open Sans"</span><span class="token punctuation">,</span>lineheight<span class="token operator">=</span><span class="token number">1.15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         plot.subtitle<span class="token operator">=</span>element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> margin <span class="token operator">=</span> margin<span class="token punctuation">(</span>t<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hjust <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.03</span><span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">"Open Sans"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         plot.caption<span class="token operator">=</span>element_text<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> margin<span class="token operator">=</span>margin<span class="token punctuation">(</span>t<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span>r<span class="token operator">=</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hjust <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">.03</span><span class="token punctuation">,</span>lineheight<span class="token operator">=</span><span class="token number">1.15</span><span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">"Open Sans"</span><span class="token punctuation">,</span> face  <span class="token operator">=</span> <span class="token string">"italic"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         legend.position<span class="token operator">=</span><span class="token string">"none"</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># color palette</span>
    my_palette <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"#3EC7F4"</span><span class="token punctuation">,</span> <span class="token string">"#3FA66C"</span><span class="token punctuation">)</span></code>`)}</pre></details> <p>It’s critical to determine plot aspects that require consistency across
the animation. I like to assign this information as variable objects so
that it can easily update across different frames contained in the
plotting code. If these aren’t explicitly noted, ggplot2 will render the
defaults in their place.</p> <details open><summary>Plot Axes, Labels, and Titles</summary> <pre class="language-r">${html(`<code class="language-r">    <span class="token comment"># y axis breaks and labels</span>
    yAxisBreaks <span class="token operator">&lt;-</span> seq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">140000</span><span class="token punctuation">,</span> by <span class="token operator">=</span> <span class="token number">20000</span><span class="token punctuation">)</span>
    yAxisLabels <span class="token operator">&lt;-</span> paste0<span class="token punctuation">(</span>format<span class="token punctuation">(</span>yAxisBreaks<span class="token punctuation">)</span><span class="token punctuation">)</span>
    yAxisLimits <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>max<span class="token punctuation">(</span>yAxisBreaks<span class="token punctuation">)</span><span class="token operator">*</span> <span class="token number">1.03</span><span class="token punctuation">)</span>
    yAxisLabels <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>yAxisLabels<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>length<span class="token punctuation">(</span>yAxisLabels<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> paste0<span class="token punctuation">(</span><span class="token string">"$"</span><span class="token punctuation">,</span>yAxisLabels<span class="token punctuation">[</span>length<span class="token punctuation">(</span>yAxisLabels<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># x axis breaks and labels</span>
    xAxis <span class="token operator">&lt;-</span> seq<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">2015</span><span class="token punctuation">,</span> by <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
    xAxisBreaks <span class="token operator">&lt;-</span> xAxis
    xAxisLimits <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">1999.5</span><span class="token punctuation">,</span> <span class="token number">2019</span><span class="token punctuation">)</span>

    <span class="token comment"># plot text</span>
    title <span class="token operator">&lt;-</span> <span class="token string">"Median sale price of homes in Abilene and Amarillo, 2000 through 2015"</span>
    subtitle <span class="token operator">&lt;-</span> <span class="token string">""</span>
    caption <span class="token operator">&lt;-</span> <span class="token string">"Information about the housing market in Texas provided by the TAMU real estate center, http://recenter.tamu.edu/."</span>
    xLab <span class="token operator">&lt;-</span> <span class="token string">"Year"</span>
    yLab <span class="token operator">&lt;-</span> <span class="token string">"Median sale price"</span>

    midPoint <span class="token operator">&lt;-</span> round<span class="token punctuation">(</span>max<span class="token punctuation">(</span>txTweenedData<span class="token operator">$</span>.frame<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token comment"># add adjustments for line labels</span>
    txTweenedData<span class="token operator">$</span>LevelLabel <span class="token operator">&lt;-</span> as.character<span class="token punctuation">(</span>txTweenedData<span class="token operator">$</span>city<span class="token punctuation">)</span>
    txTweenedData<span class="token operator">$</span>nudge_x <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>txTweenedData<span class="token operator">$</span>LevelLabel<span class="token operator">==</span><span class="token string">"Abilene"</span><span class="token punctuation">,</span> <span class="token number">1.096</span><span class="token punctuation">,</span>ifelse<span class="token punctuation">(</span>txTweenedData<span class="token operator">$</span>LevelLabel<span class="token operator">==</span><span class="token string">"Amarillo"</span><span class="token punctuation">,</span><span class="token number">1.233</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    txTweenedData<span class="token operator">$</span>nudge_y <span class="token operator">&lt;-</span> <span class="token number">0</span></code>`)}</pre></details> <h2>Creating Pauses</h2> <p>Finally we’ve reached our R animation tip - and thankfully it’s pretty
trivial! To generate pauses within an animation simply determine where
the pause exists, subset your data to include that frame, and use <code>replicate</code> and <code>grid.draw</code> to repeat that frame n-times. For instance,
say I wanted to pause at the midpoint of the animation to emphasize a
point. I’d first calculate the midpoint, then ensure that my data
includes all frames until that point: <code>subset(txTweenedData, .frame &lt;= midPoint)</code>.</p> <details open><summary>Animation Code</summary> <pre class="language-r">${html(`<code class="language-r">    <span class="token comment">#calculate midpoint of the plot</span>
    midPoint <span class="token operator">&lt;-</span> round<span class="token punctuation">(</span>max<span class="token punctuation">(</span>txTweenedData<span class="token operator">$</span>.frame<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>

    g2 <span class="token operator">&lt;-</span> ggplot<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">&lt;=</span> midPoint<span class="token punctuation">)</span><span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> year<span class="token punctuation">,</span> y <span class="token operator">=</span> median<span class="token punctuation">,</span> .frame <span class="token operator">=</span> midPoint<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        geom_point<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> min<span class="token punctuation">(</span>.frame<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>aes<span class="token punctuation">(</span>group<span class="token operator">=</span>city<span class="token punctuation">,</span> color<span class="token operator">=</span>city<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        geom_point<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> midPoint<span class="token punctuation">)</span><span class="token punctuation">,</span>aes<span class="token punctuation">(</span>group<span class="token operator">=</span>city<span class="token punctuation">,</span> color<span class="token operator">=</span>city<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        geom_line<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>group<span class="token operator">=</span>city<span class="token punctuation">,</span> color<span class="token operator">=</span>city<span class="token punctuation">,</span> cumulative <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> label<span class="token operator">=</span>LevelLabel<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">2.5</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        scale_x_continuous<span class="token punctuation">(</span>labels<span class="token operator">=</span>xAxisBreaks<span class="token punctuation">,</span> expand <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breaks<span class="token operator">=</span>xAxisBreaks<span class="token punctuation">,</span> limits <span class="token operator">=</span>xAxisLimits<span class="token punctuation">)</span> <span class="token operator">+</span>
        scale_y_continuous<span class="token punctuation">(</span>labels<span class="token operator">=</span>yAxisLabels<span class="token punctuation">,</span> expand <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breaks<span class="token operator">=</span>yAxisBreaks<span class="token punctuation">,</span>limits <span class="token operator">=</span> yAxisLimits<span class="token punctuation">)</span>
    g2</code>`)}</pre></details> <p><img src="/img/unnamed-chunk-4-1.png" alt="Creating Pauses in R"/></p> <p>Once we’ve created this frame, <code>replicate</code> and <code>grid.draw</code> repeat that
frame n-times to create a pause.</p> <pre class="language-r">${html(`<code class="language-r">    replicate<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">,</span>grid.draw<span class="token punctuation">(</span>g2<span class="token punctuation">)</span><span class="token punctuation">)</span></code>`)}</pre> <p>Simple as that!</p> <h2>Full Animation Code within <code>saveGIF</code></h2> <p><strong>(NOTE: click on the gray bars to toggle collapsing the code!)</strong></p> <details><summary>Animation Code</summary> <pre class="language-r">${html(`<code class="language-r">    saveGIF<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>

      <span class="token comment"># print from tue first frame to the midpoint of the figure</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>midPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        g1 <span class="token operator">&lt;-</span>  ggplot<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">&lt;=</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> year<span class="token punctuation">,</span> y <span class="token operator">=</span> median<span class="token punctuation">,</span> .frame <span class="token operator">=</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_point<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> min<span class="token punctuation">(</span>.frame<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>aes<span class="token punctuation">(</span>group<span class="token operator">=</span>city<span class="token punctuation">,</span> color<span class="token operator">=</span>city<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_line<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>group<span class="token operator">=</span>city<span class="token punctuation">,</span> color<span class="token operator">=</span>city<span class="token punctuation">,</span> cumulative <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> label<span class="token operator">=</span>LevelLabel<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">2.5</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          scale_x_continuous<span class="token punctuation">(</span>labels<span class="token operator">=</span>xAxisBreaks<span class="token punctuation">,</span> expand <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breaks<span class="token operator">=</span>xAxisBreaks<span class="token punctuation">,</span> limits <span class="token operator">=</span>xAxisLimits<span class="token punctuation">)</span> <span class="token operator">+</span>
          scale_y_continuous<span class="token punctuation">(</span>labels<span class="token operator">=</span>yAxisLabels<span class="token punctuation">,</span> expand <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breaks<span class="token operator">=</span>yAxisBreaks<span class="token punctuation">,</span>limits <span class="token operator">=</span> yAxisLimits<span class="token punctuation">)</span> <span class="token operator">+</span>
          theme_minimal<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> theme_white <span class="token operator">+</span> scale_color_manual<span class="token punctuation">(</span>values<span class="token operator">=</span>my_palette<span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_text<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span>aes<span class="token punctuation">(</span>label <span class="token operator">=</span>LevelLabel<span class="token punctuation">)</span><span class="token punctuation">,</span> size <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> nudge_y <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> i<span class="token punctuation">)</span><span class="token operator">$</span>nudge_y<span class="token punctuation">,</span> nudge_x <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> i<span class="token punctuation">)</span><span class="token operator">$</span>nudge_x<span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">"Open Sans"</span><span class="token punctuation">,</span> lineheight <span class="token operator">=</span> <span class="token number">0.75</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          labs<span class="token punctuation">(</span>x<span class="token operator">=</span>xLab<span class="token punctuation">,</span> y<span class="token operator">=</span>yLab<span class="token punctuation">,</span> title <span class="token operator">=</span> title<span class="token punctuation">,</span> subtitle <span class="token operator">=</span> subtitle<span class="token punctuation">,</span>
                     caption <span class="token operator">=</span> caption<span class="token punctuation">)</span>
          print<span class="token punctuation">(</span>g1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

      <span class="token comment"># print the midpoint 75 times to create a pause</span>
      g2 <span class="token operator">&lt;-</span> ggplot<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">&lt;=</span> midPoint<span class="token punctuation">)</span><span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> year<span class="token punctuation">,</span> y <span class="token operator">=</span> median<span class="token punctuation">,</span> .frame <span class="token operator">=</span> midPoint<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_point<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> min<span class="token punctuation">(</span>.frame<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>aes<span class="token punctuation">(</span>group<span class="token operator">=</span>city<span class="token punctuation">,</span> color<span class="token operator">=</span>city<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_point<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> midPoint<span class="token punctuation">)</span><span class="token punctuation">,</span>aes<span class="token punctuation">(</span>group<span class="token operator">=</span>city<span class="token punctuation">,</span> color<span class="token operator">=</span>city<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_line<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>group<span class="token operator">=</span>city<span class="token punctuation">,</span> color<span class="token operator">=</span>city<span class="token punctuation">,</span> cumulative <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> label<span class="token operator">=</span>LevelLabel<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">2.5</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          scale_x_continuous<span class="token punctuation">(</span>labels<span class="token operator">=</span>xAxisBreaks<span class="token punctuation">,</span> expand <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breaks<span class="token operator">=</span>xAxisBreaks<span class="token punctuation">,</span> limits <span class="token operator">=</span>xAxisLimits<span class="token punctuation">)</span> <span class="token operator">+</span>
          scale_y_continuous<span class="token punctuation">(</span>labels<span class="token operator">=</span>yAxisLabels<span class="token punctuation">,</span> expand <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breaks<span class="token operator">=</span>yAxisBreaks<span class="token punctuation">,</span>limits <span class="token operator">=</span> yAxisLimits<span class="token punctuation">)</span> <span class="token operator">+</span>
          theme_minimal<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> theme_white <span class="token operator">+</span> scale_color_manual<span class="token punctuation">(</span>values<span class="token operator">=</span>my_palette<span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_text<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> midPoint<span class="token punctuation">)</span><span class="token punctuation">,</span>aes<span class="token punctuation">(</span>label <span class="token operator">=</span>LevelLabel<span class="token punctuation">)</span><span class="token punctuation">,</span> size <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> nudge_y <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> midPoint<span class="token punctuation">)</span><span class="token operator">$</span>nudge_y<span class="token punctuation">,</span> nudge_x <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> midPoint<span class="token punctuation">)</span><span class="token operator">$</span>nudge_x<span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">"Open Sans"</span><span class="token punctuation">,</span> lineheight <span class="token operator">=</span> <span class="token number">0.75</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          labs<span class="token punctuation">(</span>x<span class="token operator">=</span>xLab<span class="token punctuation">,</span> y<span class="token operator">=</span>yLab<span class="token punctuation">,</span> title <span class="token operator">=</span> title<span class="token punctuation">,</span> subtitle <span class="token operator">=</span> subtitle<span class="token punctuation">,</span>
                     caption <span class="token operator">=</span> caption<span class="token punctuation">)</span>

      replicate<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">,</span>grid.draw<span class="token punctuation">(</span>g2<span class="token punctuation">)</span><span class="token punctuation">)</span>

      <span class="token comment"># print from tue midpoint of the figure until the last frame</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> midPoint<span class="token operator">:</span>max<span class="token punctuation">(</span>txTweenedData<span class="token operator">$</span>.frame<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        g3 <span class="token operator">&lt;-</span> ggplot<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">&lt;=</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> year<span class="token punctuation">,</span> y <span class="token operator">=</span> median<span class="token punctuation">,</span> .frame <span class="token operator">=</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_point<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> min<span class="token punctuation">(</span>.frame<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>aes<span class="token punctuation">(</span>group<span class="token operator">=</span>city<span class="token punctuation">,</span> color<span class="token operator">=</span>city<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_line<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>group<span class="token operator">=</span>city<span class="token punctuation">,</span> color<span class="token operator">=</span>city<span class="token punctuation">,</span> cumulative <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> label<span class="token operator">=</span>LevelLabel<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">2.5</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          scale_x_continuous<span class="token punctuation">(</span>labels<span class="token operator">=</span>xAxisBreaks<span class="token punctuation">,</span> expand <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breaks<span class="token operator">=</span>xAxisBreaks<span class="token punctuation">,</span> limits <span class="token operator">=</span>xAxisLimits<span class="token punctuation">)</span> <span class="token operator">+</span>
          scale_y_continuous<span class="token punctuation">(</span>labels<span class="token operator">=</span>yAxisLabels<span class="token punctuation">,</span> expand <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breaks<span class="token operator">=</span>yAxisBreaks<span class="token punctuation">,</span>limits <span class="token operator">=</span> yAxisLimits<span class="token punctuation">)</span> <span class="token operator">+</span>
          theme_minimal<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> theme_white <span class="token operator">+</span> scale_color_manual<span class="token punctuation">(</span>values<span class="token operator">=</span>my_palette<span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_text<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span>aes<span class="token punctuation">(</span>label <span class="token operator">=</span>LevelLabel<span class="token punctuation">)</span><span class="token punctuation">,</span> size <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> nudge_y <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> i<span class="token punctuation">)</span><span class="token operator">$</span>nudge_y<span class="token punctuation">,</span> nudge_x <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> i<span class="token punctuation">)</span><span class="token operator">$</span>nudge_x<span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">"Open Sans"</span><span class="token punctuation">,</span> lineheight <span class="token operator">=</span> <span class="token number">0.75</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          labs<span class="token punctuation">(</span>x<span class="token operator">=</span>xLab<span class="token punctuation">,</span> y<span class="token operator">=</span>yLab<span class="token punctuation">,</span> title <span class="token operator">=</span> title<span class="token punctuation">,</span> subtitle <span class="token operator">=</span> subtitle<span class="token punctuation">,</span>
                     caption <span class="token operator">=</span> caption<span class="token punctuation">)</span>
        print<span class="token punctuation">(</span>g3<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>

      <span class="token comment"># print the final frame of the figure 110 times to create an ending pause</span>
      wholeFig <span class="token operator">&lt;-</span> ggplot<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">&lt;=</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> year<span class="token punctuation">,</span> y <span class="token operator">=</span> median<span class="token punctuation">,</span> .frame <span class="token operator">=</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_point<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> min<span class="token punctuation">(</span>.frame<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>aes<span class="token punctuation">(</span>group<span class="token operator">=</span>city<span class="token punctuation">,</span> color<span class="token operator">=</span>city<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_point<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span>aes<span class="token punctuation">(</span>group<span class="token operator">=</span>city<span class="token punctuation">,</span> color<span class="token operator">=</span>city<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_line<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>group<span class="token operator">=</span>city<span class="token punctuation">,</span> color<span class="token operator">=</span>city<span class="token punctuation">,</span> cumulative <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> label<span class="token operator">=</span>LevelLabel<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">2.5</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          scale_x_continuous<span class="token punctuation">(</span>labels<span class="token operator">=</span>xAxisBreaks<span class="token punctuation">,</span> expand <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breaks<span class="token operator">=</span>xAxisBreaks<span class="token punctuation">,</span> limits <span class="token operator">=</span>xAxisLimits<span class="token punctuation">)</span> <span class="token operator">+</span>
          scale_y_continuous<span class="token punctuation">(</span>labels<span class="token operator">=</span>yAxisLabels<span class="token punctuation">,</span> expand <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breaks<span class="token operator">=</span>yAxisBreaks<span class="token punctuation">,</span>limits <span class="token operator">=</span> yAxisLimits<span class="token punctuation">)</span> <span class="token operator">+</span>
          theme_minimal<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> theme_white <span class="token operator">+</span> scale_color_manual<span class="token punctuation">(</span>values<span class="token operator">=</span>my_palette<span class="token punctuation">)</span> <span class="token operator">+</span>
          geom_text<span class="token punctuation">(</span>data <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span>aes<span class="token punctuation">(</span>label <span class="token operator">=</span>LevelLabel<span class="token punctuation">)</span><span class="token punctuation">,</span> size <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> nudge_y <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> i<span class="token punctuation">)</span><span class="token operator">$</span>nudge_y<span class="token punctuation">,</span> nudge_x <span class="token operator">=</span> subset<span class="token punctuation">(</span>txTweenedData<span class="token punctuation">,</span> .frame <span class="token operator">==</span> i<span class="token punctuation">)</span><span class="token operator">$</span>nudge_x<span class="token punctuation">,</span> family <span class="token operator">=</span> <span class="token string">"Open Sans"</span><span class="token punctuation">,</span> lineheight <span class="token operator">=</span> <span class="token number">0.75</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          labs<span class="token punctuation">(</span>x<span class="token operator">=</span>xLab<span class="token punctuation">,</span> y<span class="token operator">=</span>yLab<span class="token punctuation">,</span> title <span class="token operator">=</span> title<span class="token punctuation">,</span> subtitle <span class="token operator">=</span> subtitle<span class="token punctuation">,</span>
                     caption <span class="token operator">=</span> caption<span class="token punctuation">)</span>

      replicate<span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">,</span>grid.draw<span class="token punctuation">(</span>wholeFig<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>movie.name<span class="token operator">=</span><span class="token string">"/home/michael/Documents/animation_samples/txHousing/txHousing.gif"</span><span class="token punctuation">,</span>interval <span class="token operator">=</span> <span class="token number">.02</span><span class="token punctuation">,</span> ani.width <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">,</span> ani.height <span class="token operator">=</span> <span class="token number">612</span><span class="token punctuation">)</span></code>`)}</pre></details> <hr/> <p><img src="/img/Animation/tx_Housing.gif" alt="Median sale price of homes in Abilene and Amarillo, 2000 through 2015"/></p> <hr/> <p>Finally it’s smart to compress the final animation, since gifs can be
unwieldy.</p> <details open><summary>GIF Compression</summary> <pre class="language-r">${html(`<code class="language-r">    <span class="token comment"># compress gif</span>
    gif_compress <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ingif<span class="token punctuation">,</span> outgif<span class="token punctuation">,</span> show<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> extra.opts<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      command <span class="token operator">&lt;-</span>  sprintf<span class="token punctuation">(</span><span class="token string">"gifsicle -O3 %s &lt; %s > %s"</span><span class="token punctuation">,</span> extra.opts<span class="token punctuation">,</span> ingif<span class="token punctuation">,</span> outgif<span class="token punctuation">)</span>
      system.fun <span class="token operator">&lt;-</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>.Platform<span class="token operator">$</span>OS.type <span class="token operator">==</span> <span class="token string">"windows"</span><span class="token punctuation">)</span> shell <span class="token keyword">else</span> system
      <span class="token keyword">if</span><span class="token punctuation">(</span>show<span class="token punctuation">)</span> message<span class="token punctuation">(</span><span class="token string">"Executing: "</span><span class="token punctuation">,</span> strwrap<span class="token punctuation">(</span>command<span class="token punctuation">,</span> exdent <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">"&#92;n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      system.fun<span class="token punctuation">(</span>ifelse<span class="token punctuation">(</span>.Platform<span class="token operator">$</span>OS.type <span class="token operator">==</span> <span class="token string">"windows"</span><span class="token punctuation">,</span> sprintf<span class="token punctuation">(</span><span class="token string">""%s""</span><span class="token punctuation">,</span> shQuote<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    gif_compress<span class="token punctuation">(</span><span class="token string">"/home/michael/Documents/animation_samples/txHousing/txHousing.gif"</span><span class="token punctuation">,</span><span class="token string">"/home/michael/Documents/animation_samples/txHousing/tx_Housing.gif"</span><span class="token punctuation">,</span>extra.opts<span class="token operator">=</span><span class="token string">"--colors 256"</span><span class="token punctuation">)</span></code>`)}</pre></details>`;
}
export {
  _019_02_23_creating_pauses_in_r_animations_md as default,
  metadata
};
